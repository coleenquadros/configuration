---
$schema: /openshift/openshift-cluster-manager-1.yml
labels:
  service: osd-fleet-manager
name: osd-fleet-manager-ocm-stage
description: OpenShift Cluster Manager stage - OSD Fleet Manager
url: https://api.stage.openshift.com
accessTokenClientId: osd-fleet-manager-staging
accessTokenUrl: https://sso.redhat.com/auth/realms/redhat-external/protocol/openid-connect/token
accessTokenClientSecret:
  path: app-interface/osd-fleet-manager/stage/fleet-manager
  field: ocm-service.clientSecret
  version: 5

addonUpgradeTests:
- addon:
    $ref: /dependencies/ocm/addons/advanced-cluster-management.yml
  instance:
    $ref: /dependencies/ci-int/ci-int.yml
  name: uhc-integration-tests-staging

blockedVersions:
- ^.*-ec\..*$
- ^.*-fc\..*$
- ^4\.11\.0-rc\.[0-5]$
# Temporarily block 4.12 upgrades until after shutdown
- ^4\.12\..*$

upgradePolicyAllowedWorkloads:
- service-cluster
- management-cluster
upgradePolicyAllowedMutexes:
- service-cluster
- management-cluster

inheritVersionData:
- $ref: /dependencies/ocm/osd-fleet-manager/integration.yml

sectors:
# region support for hypershift GA:
# https://docs.google.com/document/d/1AvSgSOlnHg34IFwxIGQzakNYqoItcbRFe08Qdq0NKJ4/edit#heading=h.lvnw05606r2j
# - name: af-south-1
# - name: ap-east-1
# - name: ap-northeast-1
# - name: ap-northeast-2
# - name: ap-south-1
# - name: ap-southeast-1
- name: ap-southeast-2
- name: eu-central-1
- name: eu-west-1
- name: us-east-1
- name: us-east-2
  dependencies:
  - name: us-east-1
- name: us-west-2
  dependencies:
  - name: us-east-2
upgradePolicyDefaults:
- name: service-cluster
  matchLabels:
    ext-hypershift.openshift.io/cluster-type: service-cluster
  upgradePolicyTemplate:
    path: /ocm/osd-fleet-manager/upgrade-policy.yaml.j2
    type: jinja2
    variables:
      schedule: 0 11 * * 1-5
- name: management-cluster
  matchLabels:
    ext-hypershift.openshift.io/cluster-type: management-cluster
  upgradePolicyTemplate:
    path: /ocm/osd-fleet-manager/upgrade-policy.yaml.j2
    variables:
      schedule: 0 13 * * 1-5
upgradePolicyClusters:
- name: hs-sc-ccb0thlad
  upgradePolicy:
    workloads:
    - service-cluster
    schedule: 0 11 * * 1-5
    conditions:
      sector: us-west-2
      soakDays: 0
      mutexes:
      - service-cluster
- name: hs-mc-cd8ni7ios
  upgradePolicy:
    workloads:
    - management-cluster
    schedule: 0 13 * * 1-5
    conditions:
      sector: us-west-2
      soakDays: 0
      mutexes:
      - management-cluster
- name: hs-mc-mdqo7k4u0
  upgradePolicy:
    workloads:
    - management-cluster
    schedule: 0 13 * * 1-5
    conditions:
      sector: us-east-2
      soakDays: 0
      mutexes:
      - management-cluster
- name: hs-sc-mdqo7k4rg
  upgradePolicy:
    workloads:
    - service-cluster
    schedule: 0 11 * * 1-5
    conditions:
      sector: us-east-2
      soakDays: 0
      mutexes:
      - service-cluster
- name: hs-mc-o25vgfff0
  upgradePolicy:
    workloads:
    - management-cluster
    schedule: 0 13 * * 1-5
    conditions:
      sector: us-west-2
      soakDays: 0
      mutexes:
      - management-cluster
- name: hs-mc-op846kea0
  upgradePolicy:
    workloads:
    - management-cluster
    schedule: 0 13 * * 1-5
    conditions:
      sector: us-east-1
      soakDays: 0
      mutexes:
      - management-cluster
- name: hs-sc-op846kde0
  upgradePolicy:
    workloads:
    - service-cluster
    schedule: 0 11 * * 1-5
    conditions:
      sector: us-east-1
      soakDays: 0
      mutexes:
      - service-cluster
- name: hs-mc-8c6cdr68g
  upgradePolicy:
    workloads:
    - management-cluster
    schedule: 0 13 * * 1-5
    conditions:
      sector: us-west-2
      soakDays: 0
      mutexes:
      - management-cluster
recommendedVersions:
- workload: service-cluster
  channel: candidate
  recommendedVersion: 4.12.0-rc.5
  initialVersion: openshift-v4.12.0-rc.5-candidate
- workload: management-cluster
  channel: candidate
  recommendedVersion: 4.12.0-rc.1
  initialVersion: openshift-v4.12.0-rc.1-candidate
