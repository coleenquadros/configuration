---
$schema: /dependencies/jenkins-config-1.yml

labels:
  service: app-sre

name: ci-ext-app-sre-jobs

description: ''

app:
  $ref: /services/app-sre/app.yml

instance:
  $ref: /dependencies/ci-ext/ci-ext.yml

type: jobs

config:
- project:
    name: logs-to-elasticsearch-lambda
    label: logs-to-elasticsearch-lambda
    node: app-sre
    gh_org: app-sre
    gh_repo: logs-to-elasticsearch-lambda
    jobs:
    - 'gh-build-tag':
        display_name: build tag

- project:
    name: cognito-pre-signup-trigger
    label: cognito-pre-signup-trigger
    node: app-sre
    gh_org: app-sre
    gh_repo: cognito-pre-signup-trigger
    jobs:
    - 'gh-build-tag':
        display_name: upload zip to release

- project:
    name: kinesis-to-opensearch-lambda
    label: kinesis-to-opensearch-lambda
    node: app-sre
    gh_org: app-sre
    gh_repo: kinesis-to-opensearch-lambda
    jobs:
    - 'gh-build-tag':
        display_name: build tag

- project:
    name: fluentd
    label: app-sre
    node: app-sre
    gh_org: app-sre
    gh_repo: fluentd
    quay_org: app-sre
    build_deploy_script_path: "./build_deploy.sh"
    jobs:
    - 'gh-build-master':
        display_name: fluentd build master

- project:
    name: manifest-bouncer
    label: app-sre
    node: app-sre
    gh_org: app-sre
    gh_repo: manifest-bouncer
    quay_org: app-sre
    jobs:
    - 'gh-build-master':
        display_name: manifest-bouncer build master
    - 'gh-pr-check':
        display_name: manifest-bouncer pr-check
    - 'gh-build-tag':
        display_name: manifest-bouncer publish to pypi

- project:
    name: s3-reload
    label: app-sre
    node: app-sre
    gh_org: app-sre
    gh_repo: s3-reload
    quay_org: app-sre
    jobs:
    - 'gh-build-master':
        display_name: s3-reload build master

- project:
    name: git-keeper
    label: app-sre
    node: app-sre
    gh_org: app-sre
    gh_repo: git-keeper
    quay_org: app-sre
    jobs:
    - 'gh-build-master':
        display_name: git-keeper build master
    - 'gh-pr-check':
        display_name: git-keeper pr-check

- project:
    name: nginx-gate
    label: app-sre
    node: app-sre
    gh_org: app-sre
    gh_repo: nginx-gate
    quay_org: app-sre
    jobs:
    - 'gh-build-master':
        display_name: nginx-gate build master

- project:
    name: sretoolbox
    label: app-sre
    node: app-sre
    gh_org: app-sre
    gh_repo: sretoolbox
    quay_org: none
    jobs:
    - 'gh-pr-check':
        display_name: sretoolbox pr-check
    - 'gh-build-tag':
        display_name: sretoolbox publish to pypi

- project:
    name: app-sre-errbot
    label: app-sre
    node: app-sre
    gh_org: app-sre
    gh_repo: app-sre-errbot
    quay_org: app-sre
    build_deploy_script_path: "./hack/build_deploy.sh"
    pr_check_script_path: "./hack/pr_check.sh"
    jobs:
    - 'gh-build-master':
        display_name: app-sre-errbot build master
    - 'gh-pr-check':
        display_name: app-sre-errbot pr check

- project:
    name: rds-enhanced-metrics-exporter
    label: app-sre
    node: app-sre
    gh_org: app-sre
    gh_repo: rds-enhanced-metrics-exporter
    pr_check_script_path: "./pr_check.sh"
    jobs:
    - 'gh-pr-check':
        display_name: pr-check rds-enhanced-metrics-exporter
        concurrent_build: false
    - 'gh-build-master':
        display_name: build and push image rds-enhanced-metrics-exporter
        build_deploy_script_path: "./build_deploy.sh"

- project:
    name: vegeta-k8s
    label: app-sre
    node: app-sre
    gh_org: app-sre
    gh_repo: vegeta-k8s
    quay_org: app-sre
    jobs:
    - 'gh-build-master':
        display_name: vegeta-k8s build-master

- project:
    name: mb-k8s
    label: app-sre
    node: app-sre
    gh_org: app-sre
    gh_repo: mb-k8s
    quay_org: app-sre
    jobs:
    - 'gh-build-master':
        display_name: mb-k8s build-master

- project:
    name: test-git-commit-range
    label: app-sre
    node: app-sre
    gh_org: app-sre
    gh_repo: test-git-commit-range
    quay_org: app-sre
    jobs:
    - 'gh-build-master':
        display_name: test-git-commit-range build-master
    - 'gh-pr-check':
        display_name: test-git-commit-range pr-check

- project:
    name: nginx-redirector
    label: app-sre
    node: app-sre
    gh_org: app-sre
    gh_repo: nginx-redirector
    quay_org: app-sre
    jobs:
    - 'gh-build-master':
        display_name: nginx-redirector build-master

- project:
    name: ci-ext
    label: app-sre
    node: app-sre
    jobs:
    - 'jenkins-node-rhel8-check':
        display_name: Jenkins nodes RHEL8 subscription test build
        node: rhel8

- project:
    name: nginx-proxy-cache
    label: app-sre
    node: app-sre
    gh_org: app-sre
    gh_repo: nginx-proxy-cache
    quay_org: app-sre
    jobs:
    - 'gh-build-master':
        display_name: nginx-proxy-cache build-master
    - 'gh-pr-check':
        display_name: nginx-proxy-cache pr-check

- project:
    name: openshift-acme-build
    node: app-sre
    label: app-sre
    gh_org: app-sre
    gh_repo: openshift-acme
    jobs:
      - gh-build-master:
          display_name: openshift-acme build master
          build_deploy_script_path: make push GO=/opt/go/1.13.*/bin/go
          # Rebuild every Tuesday to get security updates
          cron_expression: 'H H * * 2'
      - gh-pr-check:
          display_name: openshift-acme PR check
          pr_check_script_path: make verify test-unit GO=/opt/go/1.13.*/bin/go
          
