---
$schema: /app-sre/slo-document-1.yml

labels:
  service: malware-detection

name: malware-detection

app:
  $ref: /services/insights/malware-detection/app.yml

namespaces:
- $ref: /services/insights/malware-detection/namespaces/malware-detection-prod.yml

slos:
- name: malware-detection availability
  SLIType: availability
  SLISpecification: Ratio of HTTP response codes that are not 5xx
  SLODetails: https://gitlab.cee.redhat.com/service/app-interface/-/tree/master/docs/console.redhat.com/app-sops/malware-detection/SLO.md
  SLOParameters:
    window: 28d
  expr: 1.00 - (sum(rate(api_3scale_gateway_api_status{exported_service="malware-detection", status="5xx"}[{{window}}])) / sum(rate(api_3scale_gateway_api_status{exported_service="malware-detection"}[{{window}}])))
  SLOTarget: 0.90
  SLOTargetUnit: percent_0_1
  prometheusRules: resources/insights-prod/malware-detection-prod/malware-detection.prometheusrules.yaml
  dashboard: https://grafana.app-sre.devshift.net/d/slo-dashboard/slo-dashboard?orgId=1&from=now-28d&to=now&var-datasource=crcp01ue1-prometheus&var-label=malware-detection

- name: malware-detection latency
  SLIType: latency
  SLISpecification: Ratio of service request durations under 4 seconds
  SLODetails: https://gitlab.cee.redhat.com/service/app-interface/-/tree/master/docs/console.redhat.com/app-sops/malware-detection/SLO.md
  SLOParameters:
    window: 28d
  expr: avg_over_time(malware_detection:sli:latency_gt_4000:pctl10rate5m[{{window}}])
  SLOTarget: 0.90
  SLOTargetUnit: percent_0_1
  prometheusRules: resources/insights-prod/malware-detection-prod/malware-detection.prometheusrules.yaml
  dashboard: https://grafana.app-sre.devshift.net/d/slo-dashboard/slo-dashboard?orgId=1&from=now-28d&to=now&var-datasource=crcp01ue1-prometheus&var-label=malware-detection
