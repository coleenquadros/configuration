---
$schema: /app-sre/app-1.yml

labels:
  service: ccx-data-pipeline
  platform: insights

name: ccx-data-pipeline

description: ccx-data-pipeline is part of the overall workflow developed and deployed 
  by the CCX team. Gives customers the ability to display information about their 
  clusters in the OpenShift Cluster Manager (OCM). Results from insights rules are
  processed to make information about clusters status (health, performance, etc...) 
  available. 

architectureDocument: https://ccx.pages.redhat.com/ccx-docs/customer/index.html
sopsUrl: https://ccx.pages.redhat.com/ccx-docs/customer/sops/index.html
grafanaUrls:
- title: CCX Processing SLO
  url: https://grafana.stage.devshift.net/d/ccxprocessingslo/ccx-processing-slo?orgId=1
onboardingStatus: OnBoarded

parentApp:
  $ref: /services/insights/app.yml

escalationPolicy:
  $ref: /teams/insights/escalation-policies/crc-ccx-escalations.yml
serviceOwners:
- name: CCX Processing Team
  email: ccx-core-processing-team@redhat.com

dependencies:
- $ref: /dependencies/github/service.yml
- $ref: /dependencies/gitlab/service.yml
- $ref: /dependencies/quay/service.yml
- $ref: /dependencies/openshift/service.yml
- $ref: /dependencies/aws/service.yml
- $ref: /dependencies/ci-int/service.yml
- $ref: /dependencies/ci-ext/service.yml
- $ref: /dependencies/kafka/service.yml
- $ref: /dependencies/sso/service.yml

sentryProjects:  # TODO: Delete when migration to glitchtip is completed
- team:
    $ref: /dependencies/sentry/teams/ccx-data-pipeline-stage.yml
  projects:
  - name: ccx-data-pipeline-stage
    description: CCX external data pipeline stage Sentry instance (temporal)
    email_prefix: '[CCX Data Pipeline - Stage]'
    platform: python
  - name: ccx-aggregator-exporter
    description: Exporter for Insights Results data stored by Insights Results Aggregator
    email_prefix: '[Insights Results Aggregator Exporter - Stage]'
    platform: go
- team:
    $ref: /dependencies/sentry/teams/ccx-data-pipeline-production.yml
  projects:
  - name: ccx-data-pipeline
    description: CCX external data pipeline production Sentry instance
    email_prefix: '[CCX Data Pipeline - Prod]'
    platform: python
  - name: io-gathering-conditions
    description: Insights operator gathering conditions service Sentry instance
    email_prefix: '[IO Gathering Conditions Service - Prod]'
    platform: go
  - name: ccx-sha-extractor
    description: Insights SHA Extractor Sentry instance
    email_prefix: '[Insights SHA Extractor - Prod]'
    platform: python
  - name: ccx-aggregator-exporter
    description: Exporter for Insights Results data stored by Insights Results Aggregator
    email_prefix: '[Insights Results Aggregator Exporter - Prod]'
    platform: go

glitchtipProjects:
- $ref: /dependencies/glitchtip/projects/glitchtip-production/ccx-data-pipeline.yml
- $ref: /dependencies/glitchtip/projects/glitchtip-production/ccx-sha-extractor.yml
- $ref: /dependencies/glitchtip/projects/glitchtip-production/ccx-aggregator-exporter.yml
- $ref: /dependencies/glitchtip/projects/glitchtip-production/io-gathering-conditions.yml

quayRepos:
- org:
    $ref: /dependencies/quay/cloudservices.yml
  items:
  - name: ccx-data-pipeline
    public: false
    description: Repo for the ccx-data-pipeline Insights app
  - name: insights-results-aggregator
    public: true
    description: Repo for the insights-results-aggregator Insights app
  - name: insights-results-aggregator-cleaner
    public: true
    description: Repo for the insights-results-aggregator-cleaner Insights app
  - name: insights-results-aggregator-exporter
    public: true
    description: Repo for the insights-results-aggregator-exporter Insights app
  - name: ccx-insights-content-service
    public: true
    description: Repo for the ccx-insights-content-service Insights app
  - name: ccx-smart-proxy
    public: true
    description: Repo for the ccx-smart-proxy Insights app
  - name: ccx-notification-writer
    public: true
    description: Repo for the ccx-notification-writer Insights app
  - name: ccx-notification-service
    public: true
    description: Repo for the ccx-notification-service Insights app
  - name: ccx-rules-ocp
    public: false
    description: Repo for rules content of ccx-rules-ocp 
  - name: io-gathering-conditions
    public: false
    description: Repo for the Insights Operator Gathering Conditions Insights app
  - name: io-gathering-conditions-service
    public: true
    description: Repo for the Insights Operator Gathering Conditions Service Insights app
  - name: ccx-sha-extractor
    public: false
    description: Repo for the insights-sha-extractor Insights app
  - name: ccx-kafka-monitor
    public: true
    description: Repo for the insights-kafka-monitor Insights app
  - name: ccx-load-test
    public: false
    description: Repo for load testing external data pipeline
  - name: insights-content-template-renderer
    public: true
    description: Repo for the insights-content-template-renderer Insights app
  - name: ccx-upgrades-inference
    public: false
    description: Repo for the ccx-upgrades-inference Insights app
  - name: ccx-upgrades-data-eng
    public: false
    description: Repo for the ccx-upgrades-data-eng Insights app
  - name: ocp-advisor-frontend
    public: true
    description: Quay repo for the OCP Advisor frontend
  - name: insights-behavioral-spec
    public: true
    description: Repository for the BDD tests for CCX services
  - name: rhobs-mock
    public: false
    description: Repository for mocking the RHOBS server
  - name: ccx-mock-ams
    public: false
    description: Repository for mocking the AMS server

codeComponents:
- name: ccx-data-pipeline
  resource: upstream
  url: https://gitlab.cee.redhat.com/ccx/ccx-data-pipeline
- name: insights-results-aggregator
  resource: upstream
  url: https://github.com/RedHatInsights/insights-results-aggregator
- name: insights-results-aggregator-cleaner
  resource: upstream
  url: https://github.com/RedHatInsights/insights-results-aggregator-cleaner
- name: insights-results-aggregator-exporter
  resource: upstream
  url: https://github.com/RedHatInsights/insights-results-aggregator-exporter
- name: ccx-insights-content-service
  resource: upstream
  url: https://github.com/RedHatInsights/insights-content-service
- name: ccx-smart-proxy
  resource: upstream
  url: https://github.com/RedHatInsights/insights-results-smart-proxy
- name: ccx-notification-writer
  resource: upstream
  url: https://github.com/RedHatInsights/ccx-notification-writer
- name: ccx-notification-service
  resource: upstream
  url: https://github.com/RedHatInsights/ccx-notification-service
- name: io-gathering-service
  resource: upstream
  url: https://github.com/RedHatInsights/insights-operator-gathering-conditions-service
- name: io-gathering-conditions
  resource: upstream
  url: https://github.com/RedHatInsights/insights-operator-gathering-conditions
- name: ccx-sha-extractor
  resource: upstream
  url: https://gitlab.cee.redhat.com/ccx/ccx-sha-extractor
- name: ccx-kafka-monitor
  resource: upstream
  url: https://github.com/RedHatInsights/insights-kafka-monitor
- name: ccx-load-test
  resource: upstream
  url: https://gitlab.cee.redhat.com/ccx/ccx-load-test
- name: ccx-insights-content-template-renderer
  resource: upstream
  url: https://github.com/RedHatInsights/insights-content-template-renderer
- name: ccx-upgrades-inference
  resource: upstream
  url: https://gitlab.cee.redhat.com/ccx/ccx-upgrades-inference
- name: ccx-upgrades-data-eng
  resource: upstream
  url: https://gitlab.cee.redhat.com/ccx/ccx-upgrades-data-eng
- name: ocp-advisor-frontend
  resource: upstream
  url: https://github.com/RedHatInsights/ocp-advisor-frontend
- name: insights-behavioral-spec
  resource: upstream
  url: https://github.com/RedHatInsights/insights-behavioral-spec
- name: rhobs-mock
  resource: upstream
  url: https://gitlab.cee.redhat.com/ccx/rhobs-mock
- name: ccx-mock-ams
  resource: upstream
  url: https://gitlab.cee.redhat.com/ccx/mock-ams
