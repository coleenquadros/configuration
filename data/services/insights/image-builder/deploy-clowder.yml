---
$schema: /app-sre/saas-file-2.yml

labels:
  service: image-builder
  platform: insights

name: image-builder-clowder
description: image-builder service deployment

# We reference our app definition here
app:
  $ref: /services/insights/image-builder/app.yml

# Deploys are carried out by a Tekton Pipeline. We have to specify which pipelines
# provider will do our deploys for us.
pipelinesProvider:
  $ref: /services/insights/pipelines/tekton.crc-pipelines.appsrep05ue1.yaml

# just ClowdApp should be enough for ephemeral deployments
managedResourceTypes:
  - ClowdApp

imagePatterns:
  - quay.io/cloudservices

# The authentication section is for providing the deploy integrations with the
# credentials they'd need to validate and perform a deploy.
authentication:
  image:
    path: app-sre/quay/app-sre-pull
    field: all


# Here we list the templates that go into deploying into our various
# clusters, along with the parameters that go into processing the templates.
resourceTemplates:
- name: image-builder
  # The URL of the Git repo where the OpenShift template can be found
  url: https://github.com/osbuild/image-builder
  # The path in the repository where the OpenShift template can be found
  path: /templates/image-builder-clowder.yml
  targets:
    - namespace:
        $ref: /services/insights/ephemeral/namespaces/ephemeral-base.yml
      disable: true # do not create an app-sre deploy job for ephemeral namespace
      ref: internal # populated by bonfire
- name: image-builder-frontend
  # The URL of the Git repo where the OpenShift template can be found
  url: https://github.com/RedHatInsights/image-builder-frontend
  # The path in the repository where the OpenShift template can be found
  path: /deploy/frontend-clowder.yml
  targets:
    - namespace:
        $ref: /services/insights/ephemeral/namespaces/ephemeral-base.yml
      disable: true # do not create an app-sre deploy job for ephemeral namespace
      ref: internal # populated by bonfire
