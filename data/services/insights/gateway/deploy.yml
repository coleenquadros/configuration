---
$schema: /app-sre/saas-file-1.yml

labels:
  service: gateway
  platform: insights

name: gateway
description: gateway app on the Insights Platform

app:
  $ref: /services/insights/gateway/app.yml

instance:
  $ref: /dependencies/ci-int/ci-int.yml

slack:
  workspace:
    $ref: /dependencies/slack/coreos.yml
  channel: team-insights-info

managedResourceTypes:
- Deployment
- DeploymentConfig
- Service

imagePatterns:
- quay.io/cloudservices

authentication:
  code:
    path: app-sre/creds/github-app-sre-bot
    field: openshift-saas-deploy
  image:
    path: insights/quay/cloudservices-push
    field: all

resourceTemplates:
- name: gateway
  path: /templates/gateway/gateway.yaml
  url: https://gitlab.cee.redhat.com/insights-platform/saas-templates
  parameters:
    API_GATEWAY_PORT: 9091
    API_GATEWAY_PORT_CI: 9192
    API_GATEWAY_PORT_DEV: 9291
    API_GATEWAY_PORT_QA: 9191
    API_GATEWAY_PORT_STAGE: 9092
    APICAST_MEM_REQ: 1024Mi
  targets:
  - namespace:
      $ref: /services/insights/gateway/namespaces/stage-3scale-stage.yml
    ref: a76e6b78b467ba53072c2141ba02dfe459f12bd4
    parameters:
      DEPLOYMENT_ENVIRONMENT: production
      IMAGE_TAG: insights-staging
      INSTANCE_ENVIRONMENT: prod
      SERVICES_LIST: 2555417766312,2555417857543,2555417825389,2555417857567,2555417768850,2555417854177,2555417761380,2555417854178,2555417854634,2555417854179,2555417782669,2555417854060,2555417833974,2555417844626,2555417763855,2555417854542,2555417854180,2555417854181,2555417771926,2555417854182,2555417769046,2555417813958,2555417857565,2555417768536,2555417854183,2555417822595,2555417764516,2555417764366,2555417862922,2555417862930,2555417869277
  - namespace:
      $ref: /services/insights/gateway/namespaces/3scale-prod.yml
    ref: c9c92ac40a2c1b0c2d65c37f7b35887c7a84f2cb
    parameters:
      DEPLOYMENT_ENVIRONMENT: production
      IMAGE_TAG: 30c69fd
      INSTANCE_ENVIRONMENT: prod
      SERVICES_LIST: 2555417795207,2555417795208,2555417795204,2555417795209,2555417795210,2555417766313,2555417778550,2555417825390,2555417775768,2555417768851,2555417766711,2555417761390,2555417846164,2555417784990,2555417833965,2555417794838,2555417849570,2555417790215,2555417782668,2555417778459,2555417847587,2555417761387,2555417810755,2555417854543,2555417847851,2555417848781,2555417771927,2555417838767,2555417766331,2555417813959,2555417782165,2555417768537,2555417824288,2555417761391,2555417822596,2555417761389,2555417766151,2555417784373,2555417825480,2555417869278
      ALLOW_EXTERNAL_TRAFFIC: 'true'
- name: platform-logger
  path: /templates/platform-logger.yaml
  url: https://github.com/RedHatInsights/platform-logger
  targets:
  - namespace:
      $ref: /services/insights/gateway/namespaces/stage-3scale-stage.yml
    ref: master
    parameters:
      CLOUD_WATCH_ALLOWED_STREAMS: 3scale-staging
  - namespace:
      $ref: /services/insights/gateway/namespaces/3scale-prod.yml
    ref: 2b6baf5db1a66e1dbd2969c6fb1eccf4e7da771f
    parameters:
      CLOUD_WATCH_ALLOWED_STREAMS: 3scale
- name: apicast-test-services
  path: /template-source.yml
  url: https://github.com/RedHatInsights/apicast-test-services
  targets:
  - namespace:
      $ref: /services/insights/gateway/namespaces/apicast-test-services-stage.yml
    ref: master
  - namespace:
      $ref: /services/insights/gateway/namespaces/apicast-test-services-prod.yml
    ref: 4b8a7d7be39ecc6cf23c737381a7fc060b9fc6f2
