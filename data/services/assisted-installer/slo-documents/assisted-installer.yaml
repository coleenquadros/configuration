---
$schema: /app-sre/slo-document-1.yml

labels:
  service: assisted-installer

name: assisted-installer

app:
  $ref: /services/assisted-installer/app.yml

namespaces:
- $ref: /services/assisted-installer/namespaces/assisted-installer-production.yml

slos:
- name: latency
  SLIType: latency
  SLISpecification: 90% of the succesful requests' latency must be under 1 seconds
  SLODetails: https://gitlab.cee.redhat.com/service/app-interface/-/blob/master/docs/assisted-installer/slos/assisted-installer-latency.md
  SLOParameters:
    window: 28d
  expr: |
    sum(rate(http_request_duration_seconds_bucket{endpoint="assisted-svc", namespace="assisted-installer-production", le="1", code!~"5.."}[{{ window }}]))
    /
    sum(rate(http_request_duration_seconds_count{endpoint="assisted-svc", namespace="assisted-installer-production", code!~"5.."}[{{ window }}]))
  SLOTarget: 0.90
  SLOTargetUnit: percent_0_1
  prometheusRules: /observability/prometheusrules/assisted-installer-production.prometheusrules.yaml
  dashboard: https://grafana.app-sre.devshift.net/dashboards/f/7a2fxwZ7k/assisted-installer

- name: availability
  SLIType: availability
  SLISpecification: 85% of the requests should succeed
  SLODetails: https://gitlab.cee.redhat.com/service/app-interface/-/blob/master/docs/assisted-installer/slos/assisted-installer-availability.md
  SLOParameters:
    window: 28d
  expr: |
    sum(rate(haproxy_backend_http_responses_total{route="assisted-service",exported_namespace="assisted-installer-production",code!~"5xx"}[{{ window }}]))
    /
    sum(rate(haproxy_backend_http_responses_total{route="assisted-service",exported_namespace="assisted-installer-production"}[{{ window }}]))
  SLOTarget: 0.85
  SLOTargetUnit: percent_0_1
  prometheusRules: /observability/prometheusrules/assisted-installer-production.prometheusrules.yaml
  dashboard: https://grafana.app-sre.devshift.net/dashboards/f/7a2fxwZ7k/assisted-installer
