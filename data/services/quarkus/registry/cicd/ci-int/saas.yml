---
$schema: /app-sre/saas-file-2.yml

labels:
  service: quarkus-registry

name: saas-quarkus-registry
description: SaaS tracking file for Quarkus Registry

app:
  $ref: /services/quarkus/registry/app.yml

pipelinesProvider:
  $ref: /services/quarkus/pipelines/tekton.code-quarkus-pipelines.app-sre-prod-01.yaml

slack:
  workspace:
    $ref: /dependencies/slack/coreos.yml
  channel: team-quarkus-info

managedResourceTypes:
  - DeploymentConfig
  - Service

imagePatterns:
  - quay.io/app-sre/registry-quarkus-redhat-app
  - quay.io/quarkus/registry-app

authentication:
  image:
    path: app-sre/quay/app-sre-pull
    field: all
  code:
    path: app-sre/creds/github-app-sre-bot
    field: openshift-saas-deploy

resourceTemplates:
  - name: registry-quarkus
    url: https://github.com/quarkusio/registry.quarkus.redhat.com
    path: /openshift/template.yaml
    targets:
      - namespace:
          $ref: /services/quarkus/registry/namespaces/registry-quarkus-redhat-stage.yml
        ref: main
        upstream:
          instance:
            $ref: /dependencies/ci-int/ci-int.yml
          name: quarkusio-registry.quarkus.redhat.com-gh-build-main
        parameters:
          REPLICAS: 3
          IMAGE: "quay.io/app-sre/registry-quarkus-redhat-app"
          SERVICE_ACCOUNT: "registry-quarkus-redhat"
          QUARKUS_REGISTRY_ID: "registry.quarkus.redhat.com"
          QUARKUS_REGISTRY_GROUPID: "com.redhat.quarkus.registry"
          QUARKUS_REGISTRY_MAVEN_REPO_URL: "https://registry.quarkus.stage.redhat.com/maven"
          QUARKUS_REGISTRY_QUARKUS_VERSIONS_EXPRESSION: "*-redhat-*"
          QUARKUS_REGISTRY_QUARKUS_VERSIONS_EXCLUSIVE_PROVIDER: "false"
          QUARKUS_REGISTRY_NON_PLATFORM_EXTENSIONS_SUPPORT: "false"
          QUARKUS_REGISTRY_CACHE_CRON: "* */5 * * * ?"
          QUARKUS_DEFAULT_PLATFORM: "com.redhat.quarkus.platform"
          QUARKUS_REGISTRY_ENVIRONMENT: "stage"
          QUARKUS_LOG_SENTRY: "true"
        promotion:
          publish:
            - registry-quarkus-redhat-stage-deploy-success-channel
      - namespace:
          $ref: /services/quarkus/registry/namespaces/registry-quarkus-redhat-production.yml
        ref: "201e189d041a5c993f7659c7c378ff899f61b18b"
        parameters:
          REPLICAS: 3
          IMAGE: "quay.io/app-sre/registry-quarkus-redhat-app"
          SERVICE_ACCOUNT: "registry-quarkus-redhat"
          QUARKUS_REGISTRY_ID: "registry.quarkus.redhat.com"
          QUARKUS_REGISTRY_GROUPID: "com.redhat.quarkus.registry"
          QUARKUS_REGISTRY_MAVEN_REPO_URL: "https://registry.quarkus.redhat.com/maven"
          QUARKUS_REGISTRY_QUARKUS_VERSIONS_EXPRESSION: "*-redhat-*"
          QUARKUS_REGISTRY_QUARKUS_VERSIONS_EXCLUSIVE_PROVIDER: "false"
          QUARKUS_REGISTRY_NON_PLATFORM_EXTENSIONS_SUPPORT: "false"
          QUARKUS_REGISTRY_CACHE_CRON: "* */5 * * * ?"
          QUARKUS_DEFAULT_PLATFORM: "com.redhat.quarkus.platform"
          QUARKUS_REGISTRY_ENVIRONMENT: "production"
          QUARKUS_LOG_SENTRY: "true"
        promotion:
          publish:
            - registry-quarkus-redhat-deploy-success-channel
