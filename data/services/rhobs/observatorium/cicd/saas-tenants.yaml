---
$schema: /app-sre/saas-file-2.yml

labels:
  service: observatorium

name: saas-observatorium-tenants-telemeter
description: SaaS file that deploys tenants in Observatorium

app:
  $ref: /services/rhobs/observatorium/app.yml

pipelinesProvider:
  $ref: /services/rhobs/observatorium/pipelines/observatorium-pipeline.appsrep05ue1.yaml

slack:
  workspace:
    $ref: /dependencies/slack/redhat-internal.yml
  channel: team-monitoring-info

imagePatterns: []

allowedSecretParameterPaths:
- rhobs/testing/observatorium-testing/observatorium-observatorium-api
- app-interface/app-sre-stage/telemeter-stage/observatorium-observatorium-api
- app-interface/app-sre/telemeter-production/observatorium-observatorium-api

managedResourceTypes:
- Secret

resourceTemplates:
- name: tenants
  path: /resources/services/observatorium-tenants-template.yaml
  url: https://github.com/rhobs/configuration
  targets:
    - namespace:
        $ref: /services/rhobs/observatorium/namespaces/observatorium-testing.yml
      ref: main
      parameters:
        SECRET_NAME: observatorium-observatorium-api
        TENANTS:
          tenants:
            - id: 0fc2b00e-201b-4c17-b9f2-19d91adc4fd2
              name: rhobs
              oidc:
                clientID: ${CLIENT_ID}
                clientSecret: ${CLIENT_SECRET}
                issuerURL: https://sso.redhat.com/auth/realms/redhat-external
                redirectURL: https://observatorium-mst.api.stage.openshift.com/oidc/rhobs/callback
                usernameClaim: preferred_username
                groupClaim: email
      secretParameters:
        - name: CLIENT_ID
          secret:
            path: rhobs/testing/observatorium-testing/observatorium-observatorium-api
            field: client-id
            version: 2
        - name: CLIENT_SECRET
          secret:
            path: rhobs/testing/observatorium-testing/observatorium-observatorium-api
            field: client-secret
            version: 2
    - namespace:
        $ref: /services/rhobs/observatorium/namespaces/observatorium-stage.yml
      ref: 18b7e373c0b59774773435ba51d091835f3fe91a
      parameters:
        SECRET_NAME: observatorium-observatorium-api
        TENANTS:
          tenants:
            - id: 0fc2b00e-201b-4c17-b9f2-19d91adc4fd2
              name: rhobs
              oidc:
                clientID: ${CLIENT_ID}
                clientSecret: ${CLIENT_SECRET}
                issuerURL: https://sso.redhat.com/auth/realms/redhat-external
                redirectURL: https://observatorium.api.stage.openshift.com/oidc/rhobs/callback
                usernameClaim: preferred_username
                groupClaim: email
            - id: FB870BF3-9F3A-44FF-9BF7-D7A047A52F43
              name: telemeter
              oidc:
                clientID: ${CLIENT_ID}
                clientSecret: ${CLIENT_SECRET}
                issuerURL: https://sso.redhat.com/auth/realms/redhat-external
                redirectURL: https://observatorium.api.stage.openshift.com/oidc/telemeter/callback
                usernameClaim: preferred_username
      secretParameters:
        - name: CLIENT_ID
          secret:
            path: app-interface/app-sre-stage/telemeter-stage/observatorium-observatorium-api
            field: client-id
            version: 22
        - name: CLIENT_SECRET
          secret:
            path: app-interface/app-sre-stage/telemeter-stage/observatorium-observatorium-api
            field: client-secret
            version: 22
    - namespace:
        $ref: /services/rhobs/observatorium/namespaces/observatorium-production.yml
      ref: 18b7e373c0b59774773435ba51d091835f3fe91a
      parameters:
        SECRET_NAME: observatorium-observatorium-api
        TENANTS:
          tenants:
            - id: 0fc2b00e-201b-4c17-b9f2-19d91adc4fd2
              name: rhobs
              oidc:
                clientID: ${CLIENT_ID}
                clientSecret: ${CLIENT_SECRET}
                issuerURL: https://sso.redhat.com/auth/realms/redhat-external
                redirectURL: https://observatorium.api.openshift.com/oidc/rhobs/callback
                usernameClaim: preferred_username
                groupClaim: email
            - id: FB870BF3-9F3A-44FF-9BF7-D7A047A52F43
              name: telemeter
              oidc:
                clientID: ${CLIENT_ID}
                clientSecret: ${CLIENT_SECRET}
                issuerURL: https://sso.redhat.com/auth/realms/redhat-external
                redirectURL: https://observatorium.api.openshift.com/oidc/telemeter/callback
                usernameClaim: preferred_username
      secretParameters:
        - name: CLIENT_ID
          secret:
            path: app-interface/app-sre/telemeter-production/observatorium-observatorium-api
            field: client-id
            version: 9
        - name: CLIENT_SECRET
          secret:
            path: app-interface/app-sre/telemeter-production/observatorium-observatorium-api
            field: client-secret
            version: 9
