---
$schema: /app-sre/saas-file-2.yml

labels:
  service: observatorium

name: saas-observatorium-tenants-mst
description: SaaS file that deploys tenants in Observatorium

app:
  $ref: /services/rhobs/observatorium/app.yml

pipelinesProvider:
  $ref: /services/rhobs/observatorium/pipelines/observatorium-pipeline.appsrep05ue1.yaml

slack:
  workspace:
    $ref: /dependencies/slack/redhat-internal.yml
  channel: team-monitoring-info

imagePatterns: []

allowedSecretParameterPaths:
- app-interface/app-sre-stage/telemeter-stage/observatorium-observatorium-mst-api
- app-interface/app-sre/telemeter-production/observatorium-observatorium-mst-api

managedResourceTypes:
- Secret

resourceTemplates:
- name: tenants
  path: /resources/services/observatorium-tenants-template.yaml
  url: https://github.com/rhobs/configuration
  targets:
    - namespace:
        $ref: /services/rhobs/observatorium-mst/namespaces/app-sre-stage-01/observatorium-mst-stage.yml
      ref: c8f188ffb521d0d3ccb713a3f99c91fd669865e0
      parameters:
        SECRET_NAME: observatorium-observatorium-mst-api
        TENANTS:
          tenants:
            - id: 0fc2b00e-201b-4c17-b9f2-19d91adc4fd2
              name: rhobs
              oidc:
                clientID: ${CLIENT_ID}
                clientSecret: ${CLIENT_SECRET}
                issuerURL: https://sso.redhat.com/auth/realms/redhat-external
                redirectURL: https://observatorium-mst.api.stage.openshift.com/oidc/rhobs/callback
                usernameClaim: preferred_username
                groupClaim: email
            - id: 770c1124-6ae8-4324-a9d4-9ce08590094b
              name: osd
              oidc:
                clientID: ${CLIENT_ID}
                clientSecret: ${CLIENT_SECRET}
                issuerURL: https://sso.redhat.com/auth/realms/redhat-external
                redirectURL: https://observatorium-mst.api.stage.openshift.com/oidc/osd/callback
                usernameClaim: preferred_username
              opa:
                url: http://127.0.0.1:8082/v1/data/observatorium/allow
              rateLimits:
                - endpoint: /api/metrics/v1/.+/api/v1/receive
                  limit: 10000
                  window: 30s
            - id: 63e320cd-622a-4d05-9585-ffd48342633e
              name: managedkafka
              oidc:
                clientID: ${CLIENT_ID}
                clientSecret: ${CLIENT_SECRET}
                issuerURL: https://sso.redhat.com/auth/realms/redhat-external
                redirectURL: https://observatorium-mst.api.stage.openshift.com/oidc/managedkafka/callback
                usernameClaim: preferred_username
              opa:
                url: http://127.0.0.1:8082/v1/data/observatorium/allow
            - id: 1b9b6e43-9128-4bbf-bfff-3c120bbe6f11
              name: rhacs
              oidc:
                clientID: ${CLIENT_ID}
                clientSecret: ${CLIENT_SECRET}
                issuerURL: https://sso.redhat.com/auth/realms/redhat-external
                redirectURL: https://observatorium-mst.api.stage.openshift.com/oidc/rhacs/callback
                usernameClaim: preferred_username
            - id: 9ca26972-4328-4fe3-92db-31302013d03f
              name: cnvqe
              oidc:
                clientID: ${CLIENT_ID}
                clientSecret: ${CLIENT_SECRET}
                issuerURL: https://sso.redhat.com/auth/realms/redhat-external
                redirectURL: https://observatorium-mst.api.stage.openshift.com/oidc/cnvqe/callback
                usernameClaim: preferred_username
            - id: 37b8fd3f-56ff-4b64-8272-917c9b0d1623
              name: psiocp
              oidc:
                clientID: ${CLIENT_ID}
                clientSecret: ${CLIENT_SECRET}
                issuerURL: https://sso.redhat.com/auth/realms/redhat-external
                redirectURL: https://observatorium-mst.api.stage.openshift.com/oidc/psiocp/callback
                usernameClaim: preferred_username
            - id: 8ace13a2-1c72-4559-b43d-ab43e32a255a
              name: rhods
              oidc:
                clientID: ${CLIENT_ID}
                clientSecret: ${CLIENT_SECRET}
                issuerURL: https://sso.redhat.com/auth/realms/redhat-external
                redirectURL: https://observatorium-mst.api.stage.openshift.com/oidc/rhods/callback
                usernameClaim: preferred_username
            - id: 2dd839e2-cf2b-424a-add4-2e826b7541ee
              name: rhoc
              oidc:
                clientID: ${CLIENT_ID}
                clientSecret: ${CLIENT_SECRET}
                issuerURL: https://sso.redhat.com/auth/realms/redhat-external
                redirectURL: https://observatorium-mst.api.stage.openshift.com/oidc/rhoc/callback
                usernameClaim: preferred_username
            - id: 99c885bc-2d64-4c4d-b55e-8bf30d98c657
              name: odfms
              oidc:
                clientID: ${CLIENT_ID}
                clientSecret: ${CLIENT_SECRET}
                issuerURL: https://sso.redhat.com/auth/realms/redhat-external
                redirectURL: https://observatorium-mst.api.stage.openshift.com/oidc/odfms/callback
                usernameClaim: preferred_username
            - id: d17ea8ce-d4c6-42ef-b259-7d10c9227e93
              name: reference-addon
              oidc:
                clientID: ${CLIENT_ID}
                clientSecret: ${CLIENT_SECRET}
                issuerURL: https://sso.redhat.com/auth/realms/redhat-external
                redirectURL: https://observatorium-mst.api.stage.openshift.com/oidc/reference-addon/callback
                usernameClaim: preferred_username
            - id: AC879303-C60F-4D0D-A6D5-A485CFD638B8
              name: dptp
              oidc:
                clientID: ${CLIENT_ID}
                clientSecret: ${CLIENT_SECRET}
                issuerURL: https://sso.redhat.com/auth/realms/redhat-external
                redirectURL: https://observatorium-mst.api.stage.openshift.com/oidc/dptp/callback
                usernameClaim: preferred_username
            - id: 3833951d-bede-4a53-85e5-f73f4913973f
              name: appsre
              oidc:
                clientID: ${CLIENT_ID}
                clientSecret: ${CLIENT_SECRET}
                issuerURL: https://sso.redhat.com/auth/realms/redhat-external
                redirectURL: https://observatorium-mst.api.stage.openshift.com/oidc/appsre/callback
                usernameClaim: preferred_username
            - id: 0031e8d6-e50a-47ea-aecb-c7e0bd84b3f1
              name: rhtap
              oidc:
                clientID: ${CLIENT_ID}
                clientSecret: ${CLIENT_SECRET}
                issuerURL: https://sso.redhat.com/auth/realms/redhat-external
                redirectURL: https://observatorium-mst.api.stage.openshift.com/oidc/rhtap/callback
                usernameClaim: preferred_username
      secretParameters:
        - name: CLIENT_ID
          secret:
            path: app-interface/app-sre-stage/telemeter-stage/observatorium-observatorium-mst-api
            field: client-id
            version: 21
        - name: CLIENT_SECRET
          secret:
            path: app-interface/app-sre-stage/telemeter-stage/observatorium-observatorium-mst-api
            field: client-secret
            version: 21
    - namespace:
        $ref: /services/rhobs/observatorium-mst/namespaces/telemeter-prod-01/observatorium-mst-production.yml
      ref: 7ce23c0549d92c40a20508551cacad08d041b28a
      parameters:
        SECRET_NAME: observatorium-observatorium-mst-api
        TENANTS:
          tenants:
            - id: 0fc2b00e-201b-4c17-b9f2-19d91adc4fd2
              name: rhobs
              oidc:
                clientID: ${CLIENT_ID}
                clientSecret: ${CLIENT_SECRET}
                issuerURL: https://sso.redhat.com/auth/realms/redhat-external
                redirectURL: https://observatorium-mst.api.openshift.com/oidc/rhobs/callback
                usernameClaim: preferred_username
                groupClaim: email
            - id: 770c1124-6ae8-4324-a9d4-9ce08590094b
              name: osd
              oidc:
                clientID: ${CLIENT_ID}
                clientSecret: ${CLIENT_SECRET}
                issuerURL: https://sso.redhat.com/auth/realms/redhat-external
                redirectURL: https://observatorium-mst.api.openshift.com/oidc/osd/callback
                usernameClaim: preferred_username
              opa:
                url: http://127.0.0.1:8082/v1/data/observatorium/allow
              rateLimits:
                - endpoint: /api/metrics/v1/.+/api/v1/receive
                  limit: 10000
                  window: 30s
            - id: 63e320cd-622a-4d05-9585-ffd48342633e
              name: managedkafka
              oidc:
                clientID: ${CLIENT_ID}
                clientSecret: ${CLIENT_SECRET}
                issuerURL: https://sso.redhat.com/auth/realms/redhat-external
                redirectURL: https://observatorium-mst.api.openshift.com/oidc/managedkafka/callback
                usernameClaim: preferred_username
              opa:
                url: http://127.0.0.1:8082/v1/data/observatorium/allow
            - id: 1b9b6e43-9128-4bbf-bfff-3c120bbe6f11
              name: rhacs
              oidc:
                clientID: ${CLIENT_ID}
                clientSecret: ${CLIENT_SECRET}
                issuerURL: https://sso.redhat.com/auth/realms/redhat-external
                redirectURL: https://observatorium-mst.api.openshift.com/oidc/rhacs/callback
                usernameClaim: preferred_username
            - id: 9ca26972-4328-4fe3-92db-31302013d03f
              name: cnvqe
              oidc:
                clientID: ${CLIENT_ID}
                clientSecret: ${CLIENT_SECRET}
                issuerURL: https://sso.redhat.com/auth/realms/redhat-external
                redirectURL: https://observatorium-mst.api.openshift.com/oidc/cnvqe/callback
                usernameClaim: preferred_username
            - id: 37b8fd3f-56ff-4b64-8272-917c9b0d1623
              name: psiocp
              oidc:
                clientID: ${CLIENT_ID}
                clientSecret: ${CLIENT_SECRET}
                issuerURL: https://sso.redhat.com/auth/realms/redhat-external
                redirectURL: https://observatorium-mst.api.openshift.com/oidc/psiocp/callback
                usernameClaim: preferred_username
            - id: 8ace13a2-1c72-4559-b43d-ab43e32a255a
              name: rhods
              oidc:
                clientID: ${CLIENT_ID}
                clientSecret: ${CLIENT_SECRET}
                issuerURL: https://sso.redhat.com/auth/realms/redhat-external
                redirectURL: https://observatorium-mst.api.openshift.com/oidc/rhods/callback
                usernameClaim: preferred_username
            - id: 2dd839e2-cf2b-424a-add4-2e826b7541ee
              name: rhoc
              oidc:
                clientID: ${CLIENT_ID}
                clientSecret: ${CLIENT_SECRET}
                issuerURL: https://sso.redhat.com/auth/realms/redhat-external
                redirectURL: https://observatorium-mst.api.openshift.com/oidc/rhoc/callback
                usernameClaim: preferred_username
            - id: 99c885bc-2d64-4c4d-b55e-8bf30d98c657
              name: odfms
              oidc:
                clientID: ${CLIENT_ID}
                clientSecret: ${CLIENT_SECRET}
                issuerURL: https://sso.redhat.com/auth/realms/redhat-external
                redirectURL: https://observatorium-mst.api.openshift.com/oidc/odfms/callback
                usernameClaim: preferred_username
            - id: d17ea8ce-d4c6-42ef-b259-7d10c9227e93
              name: reference-addon
              oidc:
                clientID: ${CLIENT_ID}
                clientSecret: ${CLIENT_SECRET}
                issuerURL: https://sso.redhat.com/auth/realms/redhat-external
                redirectURL: https://observatorium-mst.api.openshift.com/oidc/reference-addon/callback
                usernameClaim: preferred_username
            - id: 5cbac548-1546-438e-ba85-ff2c73b81afc
              name: hypershift-platform
              oidc:
                clientID: ${CLIENT_ID}
                clientSecret: ${CLIENT_SECRET}
                issuerURL: https://sso.redhat.com/auth/realms/redhat-external
                redirectURL: https://observatorium-mst.api.openshift.com/oidc/hypershift-platform/callback
                usernameClaim: preferred_username
            - id: AC879303-C60F-4D0D-A6D5-A485CFD638B8
              name: dptp
              oidc:
                clientID: ${CLIENT_ID}
                clientSecret: ${CLIENT_SECRET}
                issuerURL: https://sso.redhat.com/auth/realms/redhat-external
                redirectURL: https://observatorium-mst.api.openshift.com/oidc/dptp/callback
                usernameClaim: preferred_username
            - id: 3833951d-bede-4a53-85e5-f73f4913973f
              name: appsre
              oidc:
                clientID: ${CLIENT_ID}
                clientSecret: ${CLIENT_SECRET}
                issuerURL: https://sso.redhat.com/auth/realms/redhat-external
                redirectURL: https://observatorium-mst.api.openshift.com/oidc/appsre/callback
                usernameClaim: preferred_username
      secretParameters:
        - name: CLIENT_ID
          secret:
            path: app-interface/app-sre/telemeter-production/observatorium-observatorium-mst-api
            field: client-id
            version: 8
        - name: CLIENT_SECRET
          secret:
            path: app-interface/app-sre/telemeter-production/observatorium-observatorium-mst-api
            field: client-secret
            version: 8
    - namespace:
        $ref: /services/rhobs/observatorium-mst/namespaces/rhobsp02ue1/observatorium-mst-production.yml
      ref: 1254bdf2b5c325c7b3fe0f159766c7fff58151e0
      parameters:
        SECRET_NAME: observatorium-observatorium-mst-api
        TENANTS:
          tenants:
            - id: 0fc2b00e-201b-4c17-b9f2-19d91adc4fd2
              name: rhobs
              oidc:
                clientID: ${CLIENT_ID}
                clientSecret: ${CLIENT_SECRET}
                issuerURL: https://sso.redhat.com/auth/realms/redhat-external
                redirectURL: https://rhobs.rhobsp02ue1.api.openshift.com/oidc/rhobs/callback
                usernameClaim: preferred_username
                groupClaim: email
            - id: 5cbac548-1546-438e-ba85-ff2c73b81afc
              name: hypershift-platform
              oidc:
                clientID: ${CLIENT_ID}
                clientSecret: ${CLIENT_SECRET}
                issuerURL: https://sso.redhat.com/auth/realms/redhat-external
                redirectURL: https://rhobs.rhobsp02ue1.api.openshift.com/oidc/hypershift-platform/callback
                usernameClaim: preferred_username
              rateLimits:
                - endpoint: '/api/metrics/v1/hypershift-platform/api/v1/receive'
                  limit: 12000
                  window: 45s
            - id: 0c8fdeba-3488-43bb-95ee-ca57ba5aaaa7
              name: hypershift-platform-staging
              oidc:
                clientID: ${CLIENT_ID}
                clientSecret: ${CLIENT_SECRET}
                issuerURL: https://sso.redhat.com/auth/realms/redhat-external
                redirectURL: https://rhobs.rhobsp02ue1.api.openshift.com/oidc/hypershift-platform-staging/callback
                usernameClaim: preferred_username
              rateLimits:
                - endpoint: '/api/metrics/v1/hypershift-platform-staging/api/v1/receive'
                  limit: 12000
                  window: 45s
      secretParameters:
        - name: CLIENT_ID
          secret:
            path: app-interface/app-sre/telemeter-production/observatorium-observatorium-mst-api
            field: client-id
            version: 8
        - name: CLIENT_SECRET
          secret:
            path: app-interface/app-sre/telemeter-production/observatorium-observatorium-mst-api
            field: client-secret
            version: 8
