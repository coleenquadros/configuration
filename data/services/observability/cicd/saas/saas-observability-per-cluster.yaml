---
$schema: /app-sre/saas-file-1.yml

labels:
  service: app-sre-observability

name: saas-app-sre-observability-per-cluster
description: saas-app-sre-observability-per-cluster

app:
  $ref: /services/observability/app.yml

instance:
  $ref: /dependencies/ci-int/ci-int.yml

slack:
  workspace:
    $ref: /dependencies/slack/coreos.yml
  channel: sd-app-sre-info

managedResourceTypes:
- Prometheus
- PrometheusRule
- Service
- Subscription
- Alertmanager
- ServiceMonitor

imagePatterns:
- quay.io/app-sre

resourceTemplates:
# Prometheus
- name: prometheus
  path: /openshift/prometheus.template.yaml
  url: https://gitlab.cee.redhat.com/service/app-sre-observability
  parameters:
    VERSION: v2.15.2
    RETENTION: 30d
    PV_SIZE: 50Gi
    WAL_COMPRESSION: true
    LOG_LEVEL: debug
  targets:
  - namespace:
      $ref: /services/observability/namespaces/openshift-customer-monitoring.app-sre-stage-01.yml
    ref: master
    parameters:
      CLUSTER_LABEL: app-sre-stage-01
      ENVIRONMENT: staging
      EXTERNAL_URL: https://prometheus.app-sre-stage-01.devshift.net
      RETENTION: 30d
      LOG_LEVEL: info
  - namespace:
      $ref: /services/observability/namespaces/openshift-customer-monitoring.app-sre-stage-02.yml
    ref: 71e62f15bdb38c569a9bf0e4928668a6b5b2d2ed
    parameters:
      CLUSTER_LABEL: app-sre-stage-02
      ENVIRONMENT: staging
      EXTERNAL_URL: https://prometheus.app-sre-stage-02.devshift.net
      RETENTION: 30d
  - namespace:
      $ref: /services/observability/namespaces/openshift-customer-monitoring.appsres04ue2.yml
    ref: 71e62f15bdb38c569a9bf0e4928668a6b5b2d2ed
    parameters:
      CLUSTER_LABEL: appsres04ue2
      ENVIRONMENT: staging
      EXTERNAL_URL: https://prometheus.appsres04ue2.devshift.net
  - namespace:
      $ref: /services/observability/namespaces/openshift-customer-monitoring.crc-stg-01.yml
    ref: 71e62f15bdb38c569a9bf0e4928668a6b5b2d2ed
    parameters:
      CLUSTER_LABEL: crc-stg-01
      ENVIRONMENT: staging
      EXTERNAL_URL: https://prometheus.crc-stg-01.devshift.net
  - namespace:
      $ref: /services/observability/namespaces/openshift-customer-monitoring.crcs01ue1.yml
    ref: 71e62f15bdb38c569a9bf0e4928668a6b5b2d2ed
    parameters:
      CLUSTER_LABEL: crcs01ue1
      ENVIRONMENT: staging
      EXTERNAL_URL: https://prometheus.crcs01ue1.devshift.net
  - namespace:
      $ref: /services/observability/namespaces/openshift-customer-monitoring.hive-stage-01.yml
    ref: 71e62f15bdb38c569a9bf0e4928668a6b5b2d2ed
    parameters:
      CLUSTER_LABEL: hive-stage-01
      ENVIRONMENT: staging
      EXTERNAL_URL: https://prometheus.hive-stage-01.devshift.net
  - namespace:
      $ref: /services/observability/namespaces/openshift-customer-monitoring.hives02ue1.yml
    ref: 71e62f15bdb38c569a9bf0e4928668a6b5b2d2ed
    parameters:
      CLUSTER_LABEL: hives02ue1
      ENVIRONMENT: staging
      EXTERNAL_URL: https://prometheus.hives02ue1.devshift.net
  - namespace:
      $ref: /services/observability/namespaces/openshift-customer-monitoring.hivep01ue1.yml
    ref: 71e62f15bdb38c569a9bf0e4928668a6b5b2d2ed
    parameters:
      CLUSTER_LABEL: hivep01ue1
      ENVIRONMENT: production
      EXTERNAL_URL: https://prometheus.hivep01ue1.devshift.net
  - namespace:
      $ref: /services/observability/namespaces/openshift-customer-monitoring.hivep02ue1.yml
    ref: 71e62f15bdb38c569a9bf0e4928668a6b5b2d2ed
    parameters:
      CLUSTER_LABEL: hivep02ue1
      ENVIRONMENT: production
      EXTERNAL_URL: https://prometheus.hivep02ue1.devshift.net
  - namespace:
      $ref: /services/observability/namespaces/openshift-customer-monitoring.hivep03uw1.yml
    ref: 71e62f15bdb38c569a9bf0e4928668a6b5b2d2ed
    parameters:
      CLUSTER_LABEL: hivep03uw1
      ENVIRONMENT: production
      EXTERNAL_URL: https://prometheus.hivep03uw1.devshift.net
  - namespace:
      $ref: /services/observability/namespaces/openshift-customer-monitoring.quays02ue1.yml
    ref: 71e62f15bdb38c569a9bf0e4928668a6b5b2d2ed
    parameters:
      CLUSTER_LABEL: quays02ue1
      ENVIRONMENT: staging
      EXTERNAL_URL: https://prometheus.quays02ue1.devshift.net
      RETENTION: 30d
  - namespace:
      $ref: /services/observability/namespaces/openshift-customer-monitoring.app-sre-prod-01.yml
    ref: 71e62f15bdb38c569a9bf0e4928668a6b5b2d2ed
    parameters:
      CLUSTER_LABEL: app-sre-prod-01
      ENVIRONMENT: production
      EXTERNAL_URL: https://prometheus.app-sre-prod-01.devshift.net
  - namespace:
      $ref: /services/observability/namespaces/openshift-customer-monitoring.app-sre-prod-03.yml
    ref: 71e62f15bdb38c569a9bf0e4928668a6b5b2d2ed
    parameters:
      CLUSTER_LABEL: app-sre-prod-03
      ENVIRONMENT: production
      EXTERNAL_URL: https://prometheus.app-sre-prod-03.devshift.net
      RETENTION: 30d
  - namespace:
      $ref: /services/observability/namespaces/openshift-customer-monitoring.app-sre-prod-04.yml
    ref: 71e62f15bdb38c569a9bf0e4928668a6b5b2d2ed
    parameters:
      CLUSTER_LABEL: app-sre-prod-04
      ENVIRONMENT: production
      EXTERNAL_URL: https://prometheus.app-sre-prod-04.devshift.net
  - namespace:
      $ref: /services/observability/namespaces/openshift-customer-monitoring.quayp03ue1.yml
    ref: 71e62f15bdb38c569a9bf0e4928668a6b5b2d2ed
    parameters:
      CLUSTER_LABEL: quayp03ue1
      ENVIRONMENT: production
      EXTERNAL_URL: https://prometheus.quayp03ue1.devshift.net
      LOG_LEVEL: info
  - namespace:
      $ref: /services/observability/namespaces/openshift-customer-monitoring.quayp04ue2.yml
    ref: 71e62f15bdb38c569a9bf0e4928668a6b5b2d2ed
    parameters:
      CLUSTER_LABEL: quayp04ue2
      ENVIRONMENT: production
      EXTERNAL_URL: https://prometheus.quayp04ue2.devshift.net
      LOG_LEVEL: info
  - namespace:
      $ref: /services/observability/namespaces/openshift-customer-monitoring.quayp05ue1.yml
    ref: 71e62f15bdb38c569a9bf0e4928668a6b5b2d2ed
    parameters:
      CLUSTER_LABEL: quayp05ue1
      ENVIRONMENT: production
      EXTERNAL_URL: https://prometheus.quayp05ue1.devshift.net
      LOG_LEVEL: info
  - namespace:
      $ref: /services/observability/namespaces/openshift-customer-monitoring.telemeter-prod-01.yml
    ref: 71e62f15bdb38c569a9bf0e4928668a6b5b2d2ed
    parameters:
      CLUSTER_LABEL: telemeter-prod-01
      ENVIRONMENT: production
      EXTERNAL_URL: https://prometheus.telemeter-prod-01.devshift.net
      LOG_LEVEL: info
  - namespace:
      $ref: /services/observability/namespaces/openshift-customer-monitoring.codereadyi01ue1.yml
    ref: 71e62f15bdb38c569a9bf0e4928668a6b5b2d2ed
    parameters:
      CLUSTER_LABEL: codereadyi01ue1
      ENVIRONMENT: integration
      EXTERNAL_URL: https://prometheus.codereadyi01ue1.devshift.net
      RETENTION: 30d
  - namespace:
      $ref: /services/observability/namespaces/openshift-customer-monitoring.devsandboxp01ue1.yml
    ref: 71e62f15bdb38c569a9bf0e4928668a6b5b2d2ed
    parameters:
      CLUSTER_LABEL: devsandboxp01ue1
      ENVIRONMENT: production
      EXTERNAL_URL: https://prometheus.devsandboxp01ue1.devshift.net
  - namespace:
      $ref: /services/observability/namespaces/openshift-customer-monitoring.crcp01ue1.yml
    ref: 71e62f15bdb38c569a9bf0e4928668a6b5b2d2ed
    parameters:
      CLUSTER_LABEL: crcp01ue1
      ENVIRONMENT: production
      EXTERNAL_URL: https://prometheus.crcp01ue1.devshift.net
      RETENTION: 28d
      PV_SIZE: 100Gi
# Alertmanager
- name: alertmanager
  path: /openshift/alertmanager.template.yaml
  url: https://gitlab.cee.redhat.com/service/app-sre-observability
  parameters:
    REPLICAS: 3
    VERSION: v0.20.0
    OAUTH_PROXY_SECRET_NAME: alertmanager-auth-proxy
    STORAGE_CLASS_NAME: gp2
    LOG_LEVEL: info
    ALERTMANAGER_NAME: instance
  targets:
  - namespace:
      $ref: /services/observability/namespaces/openshift-customer-monitoring.app-sre-stage-01.yml
    ref: master
    parameters:
      REPLICAS: 1
      ENVIRONMENT: staging
      EXTERNAL_URL: https://alertmanager.app-sre-stage-01.devshift.net
  - namespace:
      $ref: /services/observability/namespaces/openshift-customer-monitoring.app-sre-stage-02.yml
    ref: 71e62f15bdb38c569a9bf0e4928668a6b5b2d2ed
    parameters:
      ENVIRONMENT: staging
      EXTERNAL_URL: https://alertmanager.app-sre-stage-02.devshift.net
  - namespace:
      $ref: /services/observability/namespaces/openshift-customer-monitoring.appsres04ue2.yml
    ref: 71e62f15bdb38c569a9bf0e4928668a6b5b2d2ed
    parameters:
      REPLICAS: 1
      ENVIRONMENT: staging
      EXTERNAL_URL: https://alertmanager.appsres04ue2.devshift.net
  - namespace:
      $ref: /services/observability/namespaces/openshift-customer-monitoring.crc-stg-01.yml
    ref: 71e62f15bdb38c569a9bf0e4928668a6b5b2d2ed
    parameters:
      ENVIRONMENT: staging
      EXTERNAL_URL: https://alertmanager.crc-stg-01.devshift.net
  - namespace:
      $ref: /services/observability/namespaces/openshift-customer-monitoring.crcs01ue1.yml
    ref: 71e62f15bdb38c569a9bf0e4928668a6b5b2d2ed
    parameters:
      ENVIRONMENT: staging
      EXTERNAL_URL: https://alertmanager.crcs01ue1.devshift.net
  - namespace:
      $ref: /services/observability/namespaces/openshift-customer-monitoring.hive-stage-01.yml
    ref: 71e62f15bdb38c569a9bf0e4928668a6b5b2d2ed
    parameters:
      ENVIRONMENT: staging
      EXTERNAL_URL: https://alertmanager.hive-stage-01.devshift.net
  - namespace:
      $ref: /services/observability/namespaces/openshift-customer-monitoring.hives02ue1.yml
    ref: 71e62f15bdb38c569a9bf0e4928668a6b5b2d2ed
    parameters:
      ENVIRONMENT: staging
      EXTERNAL_URL: https://alertmanager.hives02ue1.devshift.net
  - namespace:
      $ref: /services/observability/namespaces/openshift-customer-monitoring.hivep01ue1.yml
    ref: 71e62f15bdb38c569a9bf0e4928668a6b5b2d2ed
    parameters:
      ENVIRONMENT: production
      EXTERNAL_URL: https://alertmanager.hivep01ue1.devshift.net
  - namespace:
      $ref: /services/observability/namespaces/openshift-customer-monitoring.hivep02ue1.yml
    ref: 71e62f15bdb38c569a9bf0e4928668a6b5b2d2ed
    parameters:
      ENVIRONMENT: production
      EXTERNAL_URL: https://alertmanager.hivep02ue1.devshift.net
  - namespace:
      $ref: /services/observability/namespaces/openshift-customer-monitoring.hivep03uw1.yml
    ref: 71e62f15bdb38c569a9bf0e4928668a6b5b2d2ed
    parameters:
      ENVIRONMENT: production
      EXTERNAL_URL: https://alertmanager.hivep03uw1.devshift.net
  - namespace:
      $ref: /services/observability/namespaces/openshift-customer-monitoring.quays02ue1.yml
    ref: 71e62f15bdb38c569a9bf0e4928668a6b5b2d2ed
    parameters:
      ENVIRONMENT: staging
      EXTERNAL_URL: https://alertmanager.quays02ue1.devshift.net
  - namespace:
      $ref: /services/observability/namespaces/openshift-customer-monitoring.app-sre-prod-01.yml
    ref: 71e62f15bdb38c569a9bf0e4928668a6b5b2d2ed
    parameters:
      ENVIRONMENT: production
      EXTERNAL_URL: https://alertmanager.app-sre-prod-01.devshift.net
  - namespace:
      $ref: /services/observability/namespaces/openshift-customer-monitoring.app-sre-prod-03.yml
    ref: 71e62f15bdb38c569a9bf0e4928668a6b5b2d2ed
    parameters:
      ENVIRONMENT: production
      EXTERNAL_URL: https://alertmanager.app-sre-prod-03.devshift.net
  - namespace:
      $ref: /services/observability/namespaces/openshift-customer-monitoring.app-sre-prod-04.yml
    ref: 71e62f15bdb38c569a9bf0e4928668a6b5b2d2ed
    parameters:
      ENVIRONMENT: production
      EXTERNAL_URL: https://alertmanager.app-sre-prod-04.devshift.net
  - namespace:
      $ref: /services/observability/namespaces/openshift-customer-monitoring.quayp03ue1.yml
    ref: 71e62f15bdb38c569a9bf0e4928668a6b5b2d2ed
    parameters:
      ENVIRONMENT: production
      EXTERNAL_URL: https://alertmanager.quayp03ue1.devshift.net
  - namespace:
      $ref: /services/observability/namespaces/openshift-customer-monitoring.quayp04ue2.yml
    ref: 71e62f15bdb38c569a9bf0e4928668a6b5b2d2ed
    parameters:
      ENVIRONMENT: production
      EXTERNAL_URL: https://alertmanager.quayp04ue2.devshift.net
  - namespace:
      $ref: /services/observability/namespaces/openshift-customer-monitoring.quayp05ue1.yml
    ref: 71e62f15bdb38c569a9bf0e4928668a6b5b2d2ed
    parameters:
      ENVIRONMENT: production
      EXTERNAL_URL: https://alertmanager.quayp05ue1.devshift.net
  - namespace:
      $ref: /services/observability/namespaces/openshift-customer-monitoring.telemeter-prod-01.yml
    ref: 71e62f15bdb38c569a9bf0e4928668a6b5b2d2ed
    parameters:
      ENVIRONMENT: production
      EXTERNAL_URL: https://alertmanager.telemeter-prod-01.devshift.net
  - namespace:
      $ref: /services/observability/namespaces/openshift-customer-monitoring.codereadyi01ue1.yml
    ref: 71e62f15bdb38c569a9bf0e4928668a6b5b2d2ed
    parameters:
      REPLICAS: 1
      ENVIRONMENT: integration
      EXTERNAL_URL: https://alertmanager.codereadyi01ue1.devshift.net
  - namespace:
      $ref: /services/observability/namespaces/openshift-customer-monitoring.devsandboxp01ue1.yml
    ref: 71e62f15bdb38c569a9bf0e4928668a6b5b2d2ed
    parameters:
      ENVIRONMENT: production
      EXTERNAL_URL: https://alertmanager.devsandboxp01ue1.devshift.net
  - namespace:
      $ref: /services/observability/namespaces/openshift-customer-monitoring.crcp01ue1.yml
    ref: 71e62f15bdb38c569a9bf0e4928668a6b5b2d2ed
    parameters:
      ENVIRONMENT: production
      EXTERNAL_URL: https://alertmanager.crcp01ue1.devshift.net
