---
$schema: /app-sre/performance-parameters-1.yml

# Labels for this file in app-interface
# Not related to generated manifests
labels:
  service: observability

name: prometheus

app:
  $ref: /services/observability/app.yml

component: prometheus

# Labels that Prometheus uses to select this rules file
# These labels are added to the generated Manifest's metadata.labels
prometheusLabels:
  prometheus: app-sre
  role: alert-rules
  type: slo-rules

# Namespace that this app lives in
namespace:
  $ref: /services/observability/namespaces/app-sre-observability-production-v4.yml

SLIRecordingRules:
- name: http_rates
  kind: http_rate
  metric: prometheus_http_requests_total
  selectors:
    job: prometheus-app-sre
- name: v1_query_p90_latency_rates
  kind: latency_rate
  percentile: 90
  metric: prometheus_http_request_duration_seconds_bucket
  selectors:
    job: prometheus-app-sre
    handler: /api/v1/query

volume:
- name: volume_slo
  kind: SLO
  rules: http_rates
  threshold: 5000
  target: 99.99

latency:
- name: v1_query_latency_slo
  kind: SLO
  rules: v1_query_p90_latency_rates
  threshold: 3
  target: 99

errors:
- name: errors_slo
  kind: SLO
  rules: http_rates
  threshold: 1
  target: 99

availability:
- name: availability_slo
  kind: SLO
  rules:
    latency:
    - v1_query_latency_slo
    errors:
    - errors_slo
  target: 99
