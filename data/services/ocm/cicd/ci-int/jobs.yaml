---
$schema: /dependencies/jenkins-config-1.yml

labels:
  service: uhc

name: ci-int-uhc-jobs

description: ''

app:
  $ref: /services/ocm/app.yml

instance:
  $ref: /dependencies/ci-int/ci-int.yml

type: jobs

config:
- project:
    name: uhc-integration-tests
    label: sd-uhc
    node: rhel8
    gl_group: service
    gl_project: uhc-clusters-service
    jobs:
    - 'uhc-integration-tests':
        display_name: UHC api tests (stage)
        environment: staging
    - 'uhc-integration-tests':
        display_name: UHC api tests (integration)
        environment: integration

- project:
    name: full-cycle-tests
    label: sd-uhc
    node: rhel8
    gl_group: service
    gl_project: uhc-clusters-service
    jobs:
    - 'ocm-integration-full-cycle-tests':
        display_name: Full Cycle Tests periodic stage
        environment: staging

- project:
    name: full-cycle-upgrade-tests
    label: sd-uhc
    node: rhel8
    gl_group: service
    gl_project: uhc-clusters-service
    jobs:
    - 'ocm-upgrade-full-cycle-tests':
        display_name: Upgrade Full Cycle Tests periodic stage
        environment: staging

- project:
    name: ocm-resources
    label: sd-uhc
    node: sd-service-development-b
    gl_group: service
    gl_project: ocm-resources
    jobs:
    - 'ocm-pr-check':
        display_name: OCM Resources check merge request
    - 'ocm-build-master':
        display_name: OCM Resources run master
        concurrent_build: false
    - 'ocm-build-master-timed-stage':
        display_name: OCM Resources run master timed against stage
        concurrent_build: false
    - 'ocm-build-master-timed-production':
        display_name: OCM Resources run master timed against production
        concurrent_build: false

- project:
    name: api-tests
    label: sd-uhc
    node: sd-service-development-b
    gl_group: service
    gl_project: api-tests
    jobs:
    - 'ocm-build-image':
        display_name: API Tests build image
        concurrent_build: false
    - 'ocm-pr-check':
        display_name: API Tests check merge request
        concurrent_build: false
    - 'ocm-api-tests-timed':
        display_name: API Tests periodic stage
        environment: stage
        tests: 'readonly-single'
        cron_expression: '0 * * * *'
        upstream: openshift-saas-deploy-saas-uhc-account-manager-osd-stage
        ci_cmd: ./periodic_check.sh api-tests-stage https://api.stage.openshift.com 1 1
        disable: false
    - 'ocm-api-tests-timed':
        display_name: API Tests periodic int
        environment: integration
        tests: 'readonly-single'
        cron_expression: '20 * * * *'
        upstream: openshift-saas-deploy-saas-uhc-account-manager-osd-integration
        ci_cmd: ./periodic_check.sh api-tests-int https://api.integration.openshift.com 1 1
        disable: false
    - 'ocm-api-tests-timed':
        display_name: API Tests periodic prod
        environment: production
        tests: 'readonly-single'
        cron_expression: '40 * * * *'
        upstream: openshift-saas-deploy-saas-uhc-account-manager-osd-production
        ci_cmd: ./periodic_check.sh api-tests-prod https://api.openshift.com  1 1
        disable: false

- project:
    name: ocm-addon-test-operator
    label: sd-uhc
    node: rhel8
    gl_group: service
    gl_project: ocm-addon-test-operator
    quay_org: app-sre
    backup_ecr_push_creds_account_region: "app-sre/eu-central-1"
    jobs:
    - 'gl-pr-check':
        display_name: OCM Add-On Test Operator check merge request
    - 'gl-build-master':
        display_name: OCM Add-On Test Operator build image
        concurrent_build: false

- project:
    name: ocm-backend-ci-tests
    label: sd-uhc
    node: rhel8
    gl_group: service
    gl_project: ocm-backend-tests
    quay_org: app-sre
    jobs:
    - 'ocm-backend-ci':
        display_name: OCM Backend CI Tests by Profiles
        environment: staging
        default_channel: stable
        default_profiles: rosa-hypershift,rosa-sts-multi-advanced
        version: latest
        cron_expression: '0 0 * * 1'
    - 'gl-build-master':
        display_name: OCM QE Test build image
        branch: "master"
        concurrent_build: false

- project:
    name: ocm-acceptance-tests
    label: sd-uhc
    node: rhel8
    gl_group: ocm
    gl_project: acceptance-tests
    quay_org: app-sre
    jobs:
    - 'gl-build-master':
        display_name: OCM Acceptance Tests push image
        branch: "main"
