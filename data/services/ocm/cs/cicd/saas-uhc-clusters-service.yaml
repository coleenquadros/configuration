---
$schema: /app-sre/saas-file-2.yml
labels:
  service: uhc
name: saas-uhc-clusters-service
description: SaaS tracking file for UHC Clusters service
app:
  $ref: /services/ocm/cs/app.yml
pipelinesProvider:
  $ref: /services/ocm/pipelines/tekton.ocm-pipelines.appsrep05ue1.yaml
slack:
  workspace:
    $ref: /dependencies/slack/redhat-internal.yml
  channel: team-uhc-info
managedResourceTypes:
- Deployment
- Service
- Role
- RoleBinding

imagePatterns:
- quay.io/app-sre/uhc-clusters-service
- quay.io/app-sre/envoyproxy

authentication:
  image:
    path: app-sre/quay/app-sre-pull
    field: all
resourceTemplates:
- name: uhc-clusters-service
  url: https://gitlab.cee.redhat.com/service/uhc-clusters-service
  path: /templates/service-template.yml
  parameters:
    DEMO_MODE: false
    IMAGE_REGISTRY: quay.io
    IMAGE_REPOSITORY: app-sre/uhc-clusters-service
    REPLICAS: 3
    GATEWAY_URL: unix://localhost/sockets/egress.socket
    TELEMETER_URL: ${TELEMETER_BASE_URL}
    TOKEN_URL: ${SSO_BASE_URL}/protocol/openid-connect/token
    JWKS_URL: ${SSO_BASE_URL}/protocol/openid-connect/certs
    VERSION: latest
    DEBUG_PORT: 8081
    MEMORY_REQUEST: 500Mi
    MEMORY_LIMIT: 2Gi
    CPU_REQUEST: 200m
    CPU_LIMIT: '1'
  targets:
  - namespace:
      $ref: /services/ocm/namespaces/uhc-integration.yml
    ref: master
    upstream:
      instance:
        $ref: /dependencies/ci-int/ci-int.yml
      name: service-uhc-clusters-service-gl-build-master
    promotion:
      publish:
      - ocm-cs-deployed-int
    parameters:
      ENVIRONMENT: integration
      LOG_LEVEL: info
      DEFAULT_EXPIRATION: 36h
      MAXIMUM_EXPIRATION: 168h
      GODEBUG: ''
      FORCE_MIGRATION: ''
      JIRA_PROJECT: SDAINT
      CLUSTER_ERROR_REPORT: 'false'
      JIRA_ISSUE_TYPE: Bug
      JIRA_COMPONENTS: Provision & Uninstallation
  - namespace:
      $ref: /services/ocm/namespaces/uhc-stage.yml
    ref: 1820ac676c6424d7662bb0f8b201fca4b6f19060
    promotion:
      auto: true
      subscribe:
      - ocm-cs-deployed-int
      publish:
      - ocm-cs-deployed-stage
      promotion_data:
      - channel: ocm-cs-deployed-int
        data:
        - parent_saas: saas-uhc-clusters-service
          target_config_hash: e48b3a30d322188f
          type: parent_saas_config
    parameters:
      ENVIRONMENT: staging
      LOG_LEVEL: info
      GATEWAY_URL: unix://localhost/sockets/egress.socket
      DEFAULT_EXPIRATION: 36h
      MAXIMUM_EXPIRATION: 168h
      GODEBUG: ''
      PROVISION_SHARD_CLUSTER_LIMIT: '800'
      FORCE_MIGRATION: ''
      JIRA_PROJECT: SDAINT
      CLUSTER_ERROR_REPORT: 'true'
      JIRA_ISSUE_TYPE: Bug
      JIRA_COMPONENTS: ''
      JIRA_PRODUCT: ''
  - namespace:
      $ref: /services/ocm/namespaces/uhc-stage-appsres04ue2.yml
    ref: master
    upstream:
      instance:
        $ref: /dependencies/ci-int/ci-int.yml
      name: service-uhc-clusters-service-gl-build-master
    parameters:
      ENVIRONMENT: staging
      LOG_LEVEL: info
      DEFAULT_EXPIRATION: 36h
      MAXIMUM_EXPIRATION: 168h
      GODEBUG: ''
      PROVISION_SHARD_CLUSTER_LIMIT: '1200'
      FORCE_MIGRATION: ''
      LEADERSHIP_ENABLED: 'false'
      JIRA_PROJECT: SDAINT
      CLUSTER_ERROR_REPORT: 'true'
      JIRA_ISSUE_TYPE: Bug
      JIRA_COMPONENTS: ''
      JIRA_PRODUCT: ''
  - namespace:
      $ref: /services/ocm/namespaces/uhc-production.yml
    ref: ab63d103ad47112cd22d071121ff049cbdae314f
    parameters:
      ENVIRONMENT: production
      LOG_LEVEL: info
      GODEBUG: http2server=0
      FORCE_MIGRATION: ''
      JIRA_PROJECT: OHSS
      CLUSTER_ERROR_REPORT: 'true'
      JIRA_ISSUE_TYPE: Incident
      JIRA_COMPONENTS: ''
      JIRA_PRODUCT: ''
  - namespace:
      $ref: /services/ocm/namespaces/uhc-stage-sso-test.yml
    ref: master
    upstream:
      instance:
        $ref: /dependencies/ci-int/ci-int.yml
      name: service-uhc-clusters-service-gl-build-master
    parameters:
      ENVIRONMENT: sso-test
      LOG_LEVEL: info
      DEFAULT_EXPIRATION: 36h
      MAXIMUM_EXPIRATION: 168h
      GODEBUG: ''
      FORCE_MIGRATION: ''
