---
$schema: /app-sre/saas-file-2.yml
labels:
  service: ocm
name: hs-cmc # hypershift-cert-manager-config
description: SaaS file for Hypershift cert-manager configuration

# copied from osd-fleet-manager
app:
  $ref: /services/ocm/osd-fleet-manager/app.yml

pipelinesProvider:
  $ref: /services/ocm/pipelines/tekton.ocm-pipelines.appsrep05ue1.yaml

# copied from osd-fleet-manager
slack:
  workspace:
    $ref: /dependencies/slack/redhat-internal.yml
  channel: team-uhc-info

managedResourceTypes:
- SelectorSyncSet

imagePatterns: []

allowedSecretParameterPaths:
- app-interface/osd-fleet-manager/integration/le-privatekey
- app-sre/integrations-output/terraform-resources/hivei01ue1/osd-fleet-manager-integration/hypershift-cert-manager-route53
- app-sre/integrations-output/terraform-resources/hive-stage-01/osd-fleet-manager-stage/hypershift-cert-manager-route53
- app-sre/integrations-output/terraform-resources/hivep01ue1/osd-fleet-manager-production/hypershift-cert-manager-route53

resourceTemplates:
- name: hypershift-cert-manager-config-integration
  url: https://gitlab.cee.redhat.com/service/osd-fleet-manager
  path: /templates/cert-manager-config.yaml
  parameters:
    CLUSTER_ISSUER_EMAIL: sd-sre-platform@redhat.com
  secretParameters:
  - name: LETSENCRYPT_PRIVATE_KEY_B64
    secret:
      path: app-interface/osd-fleet-manager/integration/le-privatekey
      field: private_key
      version: 2
  - name: ROUTE53_ACCESS_KEY_ID
    secret:
      path: app-sre/integrations-output/terraform-resources/hivei01ue1/osd-fleet-manager-integration/hypershift-cert-manager-route53
      field: aws_access_key_id
      version: 1
  - name: ROUTE53_SECRET_ACCESS_KEY
    secret:
      path: app-sre/integrations-output/terraform-resources/hivei01ue1/osd-fleet-manager-integration/hypershift-cert-manager-route53
      field: aws_secret_access_key
      version: 1
  targets:
  - name: hypershift-cert-manager-config-integration-hivei01ue1
    namespace:
      $ref: /services/ocm/osd-fleet-manager/namespaces/hive/osd-fleet-manager-integration-hivei01ue1.yml
    ref: main
    upstream:
      instance:
        $ref: /dependencies/ci-int/ci-int.yml
      name: service-osd-fleet-manager-gl-build-main
    promotion:
      publish:
      - hypershift-cert-manager-config-integration-hivei01ue1

- name: hypershift-cert-manager-config-stage
  url: https://gitlab.cee.redhat.com/service/osd-fleet-manager
  path: /templates/cert-manager-config.yaml
  parameters:
    CLUSTER_ISSUER_EMAIL: sd-sre-platform@redhat.com
  secretParameters:
  - name: LETSENCRYPT_PRIVATE_KEY_B64
    secret:
      path: app-interface/osd-fleet-manager/integration/le-privatekey
      field: private_key
      version: 2
  - name: ROUTE53_ACCESS_KEY_ID
    secret:
      path: app-sre/integrations-output/terraform-resources/hive-stage-01/osd-fleet-manager-stage/hypershift-cert-manager-route53
      field: aws_access_key_id
      version: 1
  - name: ROUTE53_SECRET_ACCESS_KEY
    secret:
      path: app-sre/integrations-output/terraform-resources/hive-stage-01/osd-fleet-manager-stage/hypershift-cert-manager-route53
      field: aws_secret_access_key
      version: 1
  targets:
  - name: hypershift-cert-manager-config-stage-hive-stage-01
    namespace:
      $ref: /services/ocm/osd-fleet-manager/namespaces/hive/osd-fleet-manager-stage-hive-stage-01.yml
    ref: 9571193b9c5de3bccfdae9c8bdae600d51049dea
    promotion:
      auto: false
      subscribe:
      - hypershift-cert-manager-config-integration-hivei01ue1
      publish:
      - hypershift-cert-manager-config-stage-hive-stage-01
  - name: hypershift-cert-manager-config-stage-hives02ue1
    namespace:
      $ref: /services/ocm/osd-fleet-manager/namespaces/hive/osd-fleet-manager-stage-hives02ue1.yml
    ref: 9571193b9c5de3bccfdae9c8bdae600d51049dea
    promotion:
      auto: false
      subscribe:
      - hypershift-cert-manager-config-integration-hivei01ue1
      publish:
      - hypershift-cert-manager-config-stage-hives02ue1

- name: hypershift-cert-manager-config-production
  url: https://gitlab.cee.redhat.com/service/osd-fleet-manager
  path: /templates/cert-manager-config.yaml
  parameters:
    CLUSTER_ISSUER_EMAIL: sd-sre-platform@redhat.com
  secretParameters:
  - name: LETSENCRYPT_PRIVATE_KEY_B64
    secret:
      path: app-interface/osd-fleet-manager/integration/le-privatekey
      field: private_key
      version: 2
  - name: ROUTE53_ACCESS_KEY_ID
    secret:
      path: app-sre/integrations-output/terraform-resources/hivep01ue1/osd-fleet-manager-production/hypershift-cert-manager-route53
      field: aws_access_key_id
      version: 1
  - name: ROUTE53_SECRET_ACCESS_KEY
    secret:
      path: app-sre/integrations-output/terraform-resources/hivep01ue1/osd-fleet-manager-production/hypershift-cert-manager-route53
      field: aws_secret_access_key
      version: 1
  targets:
  - name: hypershift-cert-manager-config-production-hivep01ue1
    namespace:
      $ref: /services/ocm/osd-fleet-manager/namespaces/hive/osd-fleet-manager-production-hivep01ue1.yml
    ref: 9571193b9c5de3bccfdae9c8bdae600d51049dea
    promotion:
      publish:
      - hypershift-cert-manager-config-production-hivep01ue1
  - name: hypershift-cert-manager-config-production-hivep02ue1
    namespace:
      $ref: /services/ocm/osd-fleet-manager/namespaces/hive/osd-fleet-manager-production-hivep02ue1.yml
    ref: 9571193b9c5de3bccfdae9c8bdae600d51049dea
    promotion:
      publish:
      - hypershift-cert-manager-config-production-hivep02ue1
  - name: hypershift-cert-manager-config-production-hivep03uw1
    namespace:
      $ref: /services/ocm/osd-fleet-manager/namespaces/hive/osd-fleet-manager-production-hivep03uw1.yml
    ref: 9571193b9c5de3bccfdae9c8bdae600d51049dea
    promotion:
      publish:
      - hypershift-cert-manager-config-production-hivep03uw1
  - name: hypershift-cert-manager-config-production-hivep04ew2
    namespace:
      $ref: /services/ocm/osd-fleet-manager/namespaces/hive/osd-fleet-manager-production-hivep04ew2.yml
    ref: 9571193b9c5de3bccfdae9c8bdae600d51049dea
    promotion:
      publish:
      - hypershift-cert-manager-config-production-hivep04ew2
  - name: hypershift-cert-manager-config-production-hivep05ue1
    namespace:
      $ref: /services/ocm/osd-fleet-manager/namespaces/hive/osd-fleet-manager-production-hivep05ue1.yml
    ref: 9571193b9c5de3bccfdae9c8bdae600d51049dea
    promotion:
      publish:
      - hypershift-cert-manager-config-production-hivep05ue1
  - name: hypershift-cert-manager-config-production-hivep06uw2
    namespace:
      $ref: /services/ocm/osd-fleet-manager/namespaces/hive/osd-fleet-manager-production-hivep06uw2.yml
    ref: 9571193b9c5de3bccfdae9c8bdae600d51049dea
    promotion:
      publish:
      - hypershift-cert-manager-config-production-hivep06uw2
  - name: hypershift-cert-manager-config-production-hivep07ue2
    namespace:
      $ref: /services/ocm/osd-fleet-manager/namespaces/hive/osd-fleet-manager-production-hivep07ue2.yml
    ref: 9571193b9c5de3bccfdae9c8bdae600d51049dea
    promotion:
      publish:
      - hypershift-cert-manager-config-production-hivep07ue2
