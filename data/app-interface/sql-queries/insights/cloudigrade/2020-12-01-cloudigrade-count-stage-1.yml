---
$schema: /app-interface/app-interface-sql-query-1.yml
labels: {}
name: 2020-12-01-cloudigrade-count-stage-1
namespace:
  $ref: /services/insights/cloudigrade/namespaces/stage-cloudigrade-stage.yml
identifier: cloudigrade-stage
output: stdout
query: |
  select user_id, username, count(distinct r.id) as run_count, count(distinct i.id) as instance_count from api_run r join api_instance i on r.instance_id = i.id join api_cloudaccount ca on i.cloud_account_id = ca.id join auth_user au on ca.user_id = au.id group by user_id, username;

