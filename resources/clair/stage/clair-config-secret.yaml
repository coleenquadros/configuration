apiVersion: v1
kind: Secret
metadata:
  name: {{{ name }}}
  labels:
    version: {{{ version_label }}}
  {{%- if recycle %}}
  annotations:
    qontract.ignore_reconcile_time: "true"
    qontract.recycle: "true"
  {{%- endif %}}
data:
  config.yaml: >-
    {{% b64encode %}}
    http_listen_addr: :8080
    introspection_addr: ""
    log_level: debug
    indexer:
        connstring: host={{{ vault('app-sre/integrations-output/terraform-resources/app-sre-stage-01/clair-stage/clair-indexer-stage-rds', 'db.host') }}} port={{{ vault('app-sre/integrations-output/terraform-resources/app-sre-stage-01/clair-stage/clair-indexer-stage-rds', 'db.port') }}} user={{{ vault('app-sre/integrations-output/terraform-resources/app-sre-stage-01/clair-stage/clair-indexer-stage-rds', 'db.user') }}} dbname={{{ vault('app-sre/integrations-output/terraform-resources/app-sre-stage-01/clair-stage/clair-indexer-stage-rds', 'db.name') }}} password={{{ vault('app-sre/integrations-output/terraform-resources/app-sre-stage-01/clair-stage/clair-indexer-stage-rds', 'db.password') }}} sslmode=disable pool_max_conns=8
        scanlock_retry: 10
        layer_scan_concurrency: 5
        migrations: true
        scanner:
            package: {}
            dist: {}
            repo: {}
        airgap: false
        index_report_request_concurrency: 10
    matcher:
        connstring: host={{{ vault('app-sre/integrations-output/terraform-resources/app-sre-stage-01/clair-stage/clair-matcher-stage-rds', 'db.host') }}} port={{{ vault('app-sre/integrations-output/terraform-resources/app-sre-stage-01/clair-stage/clair-matcher-stage-rds', 'db.port') }}} user={{{ vault('app-sre/integrations-output/terraform-resources/app-sre-stage-01/clair-stage/clair-matcher-stage-rds', 'db.user') }}} dbname={{{ vault('app-sre/integrations-output/terraform-resources/app-sre-stage-01/clair-stage/clair-matcher-stage-rds', 'db.name') }}} password={{{ vault('app-sre/integrations-output/terraform-resources/app-sre-stage-01/clair-stage/clair-matcher-stage-rds', 'db.password') }}} sslmode=disable pool_max_conns=8
        max_conn_pool: 100
        indexer_addr: "http://clair-indexer"
        migrations: true
        period: 6h
        disable_updaters: false
    matchers:
        config:
            crda:
                source: quayio-stage
                key: {{{ vault('app-interface/clair/stage/config', 'crda-api-key', 4) }}}
                ecosystems:
                    - maven
    notifier:
      connstring: host={{{ vault('app-sre/integrations-output/terraform-resources/app-sre-stage-01/clair-stage/clair-notifier-stage-rds', 'db.host') }}} port={{{ vault('app-sre/integrations-output/terraform-resources/app-sre-stage-01/clair-stage/clair-notifier-stage-rds', 'db.port') }}} user={{{ vault('app-sre/integrations-output/terraform-resources/app-sre-stage-01/clair-stage/clair-notifier-stage-rds', 'db.user') }}} dbname={{{ vault('app-sre/integrations-output/terraform-resources/app-sre-stage-01/clair-stage/clair-notifier-stage-rds', 'db.name') }}} password={{{ vault('app-sre/integrations-output/terraform-resources/app-sre-stage-01/clair-stage/clair-notifier-stage-rds', 'db.password') }}} sslmode=disable pool_max_conns=8
      migrations: true
      indexer_addr: "http://clair-indexer"
      matcher_addr: "http://clair-matcher"
      poll_interval: 6h
      delivery_interval: 1m
      amqp: null
      stomp: null
    auth:
        psk:
            key: {{{ vault('app-interface/clair/stage/config', 'psk', 3) }}}
            iss:
                - quay
                - clairctl
    metrics:
        name: prometheus
    {{%- endb64encode %}}
